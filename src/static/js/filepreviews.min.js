function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function(){function InvalidCharacterError(message){this.message=message}var object="undefined"!=typeof exports?exports:this,chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",object.btoa||(object.btoa=function(input){for(var block,charCode,str=String(input),idx=0,map=chars,output="";str.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){if(charCode=str.charCodeAt(idx+=.75),charCode>255)throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");block=block<<8|charCode}return output}),object.atob||(object.atob=function(input){var str=String(input).replace(/=+$/,"");if(str.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output})}(),function(){function fXMLHttpRequest(){!window.XMLHttpRequest||bIE7?this._object=new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest.isNormalizedObject?this._object=new oXMLHttpRequest:this._object=new window.XMLHttpRequest,this._listeners=[]}function cXMLHttpRequest(){return new fXMLHttpRequest}function fXMLHttpRequest_send(oRequest){if(oRequest._object.send(oRequest._data),bGecko&&!oRequest._async)for(oRequest.readyState=cXMLHttpRequest.OPENED,fSynchronizeValues(oRequest);oRequest.readyState<cXMLHttpRequest.DONE;)if(oRequest.readyState++,fReadyStateChange(oRequest),oRequest._aborted)return}function fReadyStateChange(oRequest){cXMLHttpRequest.onreadystatechange&&cXMLHttpRequest.onreadystatechange.apply(oRequest),oRequest.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:(new Date).getTime()})}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;return bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(oDocument=new window.ActiveXObject("Microsoft.XMLDOM"),oDocument.async=!1,oDocument.validateOnParse=!1,oDocument.loadXML(sResponse)),oDocument&&(bIE&&0!=oDocument.parseError||!oDocument.documentElement||oDocument.documentElement&&"parsererror"==oDocument.documentElement.tagName)?null:oDocument}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText}catch(e){}try{oRequest.responseXML=fGetDocument(oRequest._object)}catch(e){}try{oRequest.status=oRequest._object.status}catch(e){}try{oRequest.statusText=oRequest._object.statusText}catch(e){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new window.Function}var oXMLHttpRequest=window.XMLHttpRequest,bGecko=!!window.controllers,bIE=!!window.document.namespaces,bIE7=bIE&&window.navigator.userAgent.match(/MSIE 7.0/);cXMLHttpRequest.prototype=fXMLHttpRequest.prototype,bGecko&&oXMLHttpRequest.wrapped&&(cXMLHttpRequest.wrapped=oXMLHttpRequest.wrapped),cXMLHttpRequest.isNormalizedObject=!0,cXMLHttpRequest.UNSENT=0,cXMLHttpRequest.OPENED=1,cXMLHttpRequest.HEADERS_RECEIVED=2,cXMLHttpRequest.LOADING=3,cXMLHttpRequest.DONE=4,cXMLHttpRequest.prototype.UNSENT=cXMLHttpRequest.UNSENT,cXMLHttpRequest.prototype.OPENED=cXMLHttpRequest.OPENED,cXMLHttpRequest.prototype.HEADERS_RECEIVED=cXMLHttpRequest.HEADERS_RECEIVED,cXMLHttpRequest.prototype.LOADING=cXMLHttpRequest.LOADING,cXMLHttpRequest.prototype.DONE=cXMLHttpRequest.DONE,cXMLHttpRequest.prototype.readyState=cXMLHttpRequest.UNSENT,cXMLHttpRequest.prototype.responseText="",cXMLHttpRequest.prototype.responseXML=null,cXMLHttpRequest.prototype.status=0,cXMLHttpRequest.prototype.statusText="",cXMLHttpRequest.prototype.priority="NORMAL",cXMLHttpRequest.prototype.onreadystatechange=null,cXMLHttpRequest.onreadystatechange=null,cXMLHttpRequest.onopen=null,cXMLHttpRequest.onsend=null,cXMLHttpRequest.onabort=null,cXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){var sLowerCaseMethod=sMethod.toLowerCase();if("connect"==sLowerCaseMethod||"trace"==sLowerCaseMethod||"track"==sLowerCaseMethod)throw new Error(18);delete this._headers,arguments.length<3&&(bAsync=!0),this._async=bAsync;var oRequest=this,nState=this.readyState,fOnUnload=null;bIE&&bAsync&&(fOnUnload=function(){nState!=cXMLHttpRequest.DONE&&(fCleanTransport(oRequest),oRequest.abort())},window.attachEvent("onunload",fOnUnload)),cXMLHttpRequest.onopen&&cXMLHttpRequest.onopen.apply(this,arguments),arguments.length>4?this._object.open(sMethod,sUrl,bAsync,sUser,sPassword):arguments.length>3?this._object.open(sMethod,sUrl,bAsync,sUser):this._object.open(sMethod,sUrl,bAsync),this.readyState=cXMLHttpRequest.OPENED,fReadyStateChange(this),this._object.onreadystatechange=function(){return!bGecko||bAsync?(oRequest.readyState=oRequest._object.readyState,fSynchronizeValues(oRequest),oRequest._aborted?void(oRequest.readyState=cXMLHttpRequest.UNSENT):void(oRequest.readyState==cXMLHttpRequest.DONE&&(delete oRequest._data,fCleanTransport(oRequest),bIE&&bAsync&&window.detachEvent("onunload",fOnUnload),nState!=oRequest.readyState&&fReadyStateChange(oRequest),nState=oRequest.readyState))):void 0}},cXMLHttpRequest.prototype.send=function(vData){cXMLHttpRequest.onsend&&cXMLHttpRequest.onsend.apply(this,arguments),arguments.length||(vData=null),vData&&vData.nodeType&&(vData=window.XMLSerializer?(new window.XMLSerializer).serializeToString(vData):vData.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=vData,fXMLHttpRequest_send(this)},cXMLHttpRequest.prototype.abort=function(){cXMLHttpRequest.onabort&&cXMLHttpRequest.onabort.apply(this,arguments),this.readyState>cXMLHttpRequest.UNSENT&&(this._aborted=!0),this._object.abort(),fCleanTransport(this),this.readyState=cXMLHttpRequest.UNSENT,delete this._data},cXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},cXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName)},cXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){return this._headers||(this._headers={}),this._headers[sName]=sValue,this._object.setRequestHeader(sName,sValue)},cXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){for(var oListener,nIndex=0;oListener=this._listeners[nIndex];nIndex++)if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture)return;this._listeners.push([sName,fHandler,bUseCapture])},cXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){for(var oListener,nIndex=0;(oListener=this._listeners[nIndex])&&(oListener[0]!=sName||oListener[1]!=fHandler||oListener[2]!=bUseCapture);nIndex++);oListener&&this._listeners.splice(nIndex,1)},cXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={type:oEvent.type,target:this,currentTarget:this,eventPhase:2,bubbles:oEvent.bubbles,cancelable:oEvent.cancelable,timeStamp:oEvent.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==oEventPseudo.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo]);for(var oListener,nIndex=0;oListener=this._listeners[nIndex];nIndex++)oListener[0]!=oEventPseudo.type||oListener[2]||(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo])},cXMLHttpRequest.prototype.toString=function(){return"[object XMLHttpRequest]"},cXMLHttpRequest.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(oRequest,oArguments){oArguments||(oArguments=[]),oRequest.__func=this,oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]),delete oRequest.__func}),window.XMLHttpRequest=cXMLHttpRequest}(),function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.ajax=factory()}(this,function(){function ajax(url,options){options=options||{},options.method=options.method||"GET",options.headers=options.headers||{},options.success=options.success||function(){},options.error=options.error||function(){},options.async="undefined"==typeof options.async?!0:options.async;var client=new XMLHttpRequest;client.open(options.method,url);for(var i in options.headers)options.headers.hasOwnProperty(i)&&client.setRequestHeader(i,options.headers[i]);return client.send(options.data),client.onreadystatechange=function(){4==this.readyState&&200==this.status?options.success(this.responseText,this):4==this.readyState&&options.error(this.status,this.statusText,this)},client}return ajax});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FilePreviews=function(){function FilePreviews(options){_classCallCheck(this,FilePreviews);var opts=options||{};if(this.API_URL="https://api.filepreviews.io/v2",this.debug=opts.debug||!1,this.apiKey=opts.apiKey,this._ajax=ajax,!opts.apiKey)throw new Error("Missing required apiKey.")}return _createClass(FilePreviews,[{key:"log",value:function(msg){this.debug&&console.log(msg)}},{key:"generate",value:function(url,options,callback){2===arguments.length?"[object Function]"===Object.prototype.toString.call(options)&&(callback=options):1===arguments.length&&(options={}),this.request(this.API_URL+"/previews/",{method:"POST",data:JSON.stringify(this.getAPIRequestData(url,options))},function(err,result){callback&&callback(err,result)})}},{key:"retrieve",value:function(previewId,callback){this.request(this.API_URL+"/previews/"+previewId+"/",{method:"GET"},function(err,result){callback&&callback(err,result)})}},{key:"request",value:function(url,options,callback){var data,_this=this,_options=options||{},onSuccess=function(response,xhr){_this.log("API request success: "+xhr.status+" "+xhr.statusText),data=JSON.parse(response),_this.log("API request response: "+data),callback(null,data)},onError=function(status,message,xhr){try{data=JSON.parse(xhr.responseText)}catch(e){data=xhr.responseText}201===status?onSuccess(xhr.responseText,xhr):(_this.log("API request error: "+status),callback(data))},requestOptions={headers:this.getAPIRequestHeaders(),method:_options.method||"GET",success:onSuccess,error:onError};_options.data&&(requestOptions.data=_options.data),this.log("API request to: "+url),this._ajax(url,requestOptions)}},{key:"getAPIRequestHeaders",value:function(){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+btoa(this.apiKey)+":"}}},{key:"getAPIRequestData",value:function(url,options){var size;return 2===arguments.length?"[object Function]"===Object.prototype.toString.call(options)&&(options={}):1===arguments.length&&(options={}),options&&(options.url=url,options.size&&(size="",options.size.width&&(size=options.size.width),options.size.height&&(size=size+"x"+options.size.height),options.sizes=[size])),options}}]),FilePreviews}();